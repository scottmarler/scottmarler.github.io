<!DOCTYPE html>
<html>
<head>
<title>GCU Clan Family Info</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="text/javascript" src="d3/d3.js"></script>
<script type="text/javascript" src="d3/d3.layout.js"></script>
<script src="lib/d3.js"></script>
<script src="lib/underscore.js"></script>
<script src="js/mapper.js"></script>
<style>
* {
  box-sizing: border-box;
}

#tooltip1 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#tooltip2 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#tooltip3 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#tooltip4 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#tooltip5 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#tooltip6 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#circle_tooltip1 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#circle_tooltip2 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#circle_tooltip3 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#circle_tooltip4 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#circle_tooltip5 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#circle_tooltip6 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#circle_tooltip7 {
color: white;
opacity: .9;
background: #333;
padding: 5px;
border: 1px solid lightgrey;
border-radius: 5px;
position: absolute;
z-index: 10;
visibility: hidden;
white-space: nowrap;
pointer-events: none;
}

#circle circle {
fill: none;
pointer-events: all;
}
path.group {
fill-opacity: .8;
}
path.chord {
fill-opacity: .8;
stroke: #000;
stroke-width: .25px;
}
#circle:hover path.fade {
display: none;
}

text {
  font-size: 11px;
  pointer-events: none;
}

text.parent {
  fill: #1f77b4;
}

circle {
  fill: #ccc;
  stroke: #999;
  pointer-events: all;
}

circle.parent {
  fill: #1f77b4;
  fill-opacity: .1;
  stroke: steelblue;
}

circle.parent:hover {
  stroke: #ff7f0e;
  stroke-width: .5px;
}

/* Style the body */
body {
  font-family: Arial;
  margin: 0;
}

/* Header/logo Title */
.header {
  padding: 120px;
  text-align: center;
  background-image: url('/banner.JPG');
  background-repeat: no-repeat;
  background-position: center center;
  color: white;
}

/* Style the top navigation bar */
.navbar {
  display: flex;
  background-color: #333;
}

/* Style the navigation bar links */
.navbar a {
  color: white;
  padding: 14px 20px;
  text-decoration: none;
  text-align: center;
}

/* Change color on hover */
.navbar a:hover {
  background-color: #ddd;
  color: black;
}

/* Column container */
.row {  
  display: flex;
  flex-wrap: wrap;
}

/* Create two unequal columns that sits next to each other */
/* Sidebar/left column */
.side {
  flex: 30%;
  background-color: #f1f1f1;
  padding: 20px;
}

/* Main column */
.main {
  flex: 70%;
  background-color: white;
  padding: 20px;
}

/* Fake image, just for this example */
.fakeimg {
  background-color: #aaa;
  width: 100%;
  padding: 20px;
}

/* Footer */
.footer {
  padding: 20px;
  text-align: center;
  background: #ddd;
}

/* Responsive layout - when the screen is less than 700px wide, make the two columns stack on top of each other instead of next to each other */
@media screen and (max-width: 700px) {
  .row, .navbar {   
    flex-direction: column;
  }
  
 
}


</style>
</head>
<body>

<!-- Note 
<div style="background:yellow;padding:5px">
  <h4 style="text-align:center">Resize the browser window to see the responsive effect.</h4>
</div> -->

<!-- Header -->
<div class="header">
  <h1>Some mildly interesting information about the family of GCU clans</h1>
  <p>This will be <b>uninteresting</b> to most people.</p>
</div>

<!-- Navigation Bar -->
<div class="navbar">
  <a target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/groups/1372346449515232/">Main Facebook Group</a>
  <a target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/groups/1849608365155216/">Clan Facebook Group</a>
  <a target="_blank" rel="noopener noreferrer" href="Roster/index.html">Current Roster</a>
  <a target="_blank" rel="noopener noreferrer" href="PCVis/index.html">Individual Points Visualization</a>
  <a target="_blank" rel="noopener noreferrer" href="barchart.html">End-of-Season Point Totals</a>
</div>

<!-- The flexible grid (content) -->
<div class="row">
  <div class="side">
    <h2>About Us</h2>
    <p>Golf Clash University is a Facebook group dedicated to teaching people how to play Golf Clash.</p>
    <p>The GCU Clan is run by the GCU group administrators and is open to any member of GCU, regardless of how much they play.</p>
    
    <h2>A Bit More In-Depth</h2>
    <p>We’re a family of related clans, managed under a single organizational structure. This family is open to anybody who is already part of the GCU group on Facebook. There are *no* other requirements, apart from generally not being a toxic jerk-face and being a part of the GCU Clan group as well.</p>
    
    <p>Our entire philosophy is that everybody has a style and pace of play that works best for them. We have no desire to change that. Instead, we’ve set up a system so that everybody is grouped with others who earn *roughly* the same number of clan points. That way nobody is dragging down the go-getters who want to push higher and compete with each other and, conversely, nobody feels pressured to grind to maintain some minimum standard. So, in the end, we all enjoy the (admittedly lame) clan perks that make sense for our level of play while having as much comradery with our fellow clan mates as we like.</p>
    
    <p>If you’re already a member of GCU, you can probably guess approximately how much drama you can expect to find here. If you’re a bad guesser, or maybe a “bad test taker,” here’s the answer: none. We hate drama, we hate hearing about other people’s drama, and we hate writing about how much we hate drama because that’s getting waaaaay too close to it. We want to play golf and have fun and comment with an occasional funny gif.</p>
    
    <p>Technically speaking, the way this works is that at the end of every season, we take the top 10 and bottom 10 point earners in every clan and place them into a pool. That pool is sorted based on points, and then everybody is placed into whichever clan opening is appropriate. Because of this, you can go from the top to the bottom, the bottom to the top, stay right where you are, or something in between. There are no guaranteed promotions or demotions…it all just depends on how your point totals compare to everybody else in the pool. This is the most fair system we could come up with. Your participation in this clan family implies that you understand and accept this way of life! Furthermore, we (the admin staff) reserve the right to make decisions on a case-by-case basis based on logic and our ability to think that may deviate from what I just outlined; but that will be rare.</p>
    
    <p>If you'd like to join us, become a part of the GCU community and then join the GCU clan group. Once there, just make a post saying you’re new and want to join a clan. Tell us the name of your in-game account, too. For example, if your name on Facebook is “Turd Fergison”, your default in-game name is just “Turd”. But maybe you changed it and now it’s “Sean Connery.” Whatever it is, we need to know.</p>
    
    <h2>What's the purpose of this website?</h2>
    <p>Honestly, I just wanted a place to share some cool visualizations I made about the clan.</p>
  </div>
  <div class="main">
    <h2>Season 1</h2>
    <h5>Where it all began. Sep 30, 2018 - Oct 28, 2018</h5>
    <p>Click/tap to zoom. Circles are sized based on the number of points contained within at the end of the season.</p>
    <div id="s1" style="height:600px;"><div id="circle_tooltip1"></div></div>
    <br>
    <h2>The Big Shuffle</h2>
    <h4>It was like Musical Chairs, but WAY less efficient</h4>
    <p>The purpose of the first season was to see where everyone would end up with points. Using these results, we did a major shuffle to establish more appropriate clans.</p>
    <div id="shuffle1" style="height:600px;"><div id="tooltip1"></div></div>
    <p></p>
    <h2>Season 2</h2>
    <h5>Oct 28, 2018 - Nov 25, 2018</h5>
    <p>Hey, remember when we thought we could prevent everyone from logging in so we could try to control which bracket the clan would enter? lol.</p>
    <div id="s2" style="height:600px;"><div id="circle_tooltip2"></div></div>
    <p></p>
    <br>
    <h2>A More Manageable Shuffle</h2>
    <h5>We're starting to figure this thing out.</h5>
    <p></p>
    <div id="shuffle2" style="height:600px;"><div id="tooltip2"></div></div>
    <p></p>
    <h2>Season 3</h2>
    <h5>Nov 25, 2018 - Dec 23, 2018</h5>
    <p></p>
    <div id="s3" style="height:600px;"><div id="circle_tooltip3"></div></div>
    <br>
    <h2>Every Month We're Shuf-fl-in'</h2>
    <h5>Business as usual</h5>
    <p></p>
    <div id="shuffle3" style="height:600px;"><div id="tooltip3"></div></div>
    <p></p>
    <h2>Season 4</h2>
    <h5>Dec 23, 2018 - Jan 20, 2019</h5>
    <div id="s4" style="height:600px;"><div id="circle_tooltip4"></div></div>
    <br>
    <h2>Things got out of whack so we needed a bigger shuffle. Damn.</h2>
    <h5>Full shuffle for clans D through G. Used average points to decide placement.</h5>
    <p></p>
    <div id="shuffle4" style="height:600px;"><div id="tooltip4"></div></div>
    <p></p>
    <h2>Season 5</h2>
    <h5>Jan 20, 2019 - Feb 17, 2019</h5>
    <p></p>
    <div id="s5" style="height:600px;"><div id="circle_tooltip5"></div></div>
    <br>
    <h2>A LOT changed in S5. Most notably, we joined forces with WolfPack to form WolfPack University (WPU). This removed several Anarchy accounts.</h2>
    <h5>Full shuffle for all clans. Used time-weighted average points to decide placement.</h5>
    <p></p>
    <div id="shuffle5" style="height:600px;"><div id="tooltip5"></div></div>
    <p></p>
    <h2>Season 6</h2>
    <h5>Feb 17, 2019 - Mar 17, 2019</h5>
    <p></p>
    <div id="s6" style="height:600px;"><div id="circle_tooltip5"></div></div>
    <br>
    <h2></h2>
    <h5></h5>
    <p></p>
    <div id="shuffle6" style="height:600px;"><div id="tooltip5"></div></div>
    <p></p>
    <h2>Season 7</h2>
    <h5>Mar 17, 2019 - Apr 14, 2019</h5>
    <p>Circles will be drawn to scale when S7 points are recorded.</p>
    <div id="s7" style="height:600px;"><div id="circle_tooltip6"></div></div>
  </div>
</div>

<!-- Footer -->
<div class="footer">
  <h2>You've reached the bottom of the page.</h2>
  <a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=U9t-slLl30E">This is the Bad Lip Reading music video called "SEAGULLS! (Stop It Now)". If you haven't seen it, do yourself a favor and click here.</a>
</div>

    <script>

        var w1 = 600,
            h1 = 600,
            r1 = 550,
            x1 = d3.scale.linear().range([0, r1]),
            y1 = d3.scale.linear().range([0, r1]),
            node1,
            root1;

        var pack1 = d3.layout.pack()
            .size([r1, r1])
            .value(function(d) { return d.size; })

        var vis1 = d3.select("#s1").insert("svg:svg")
            .attr("width", w1)
            .attr("height", h1)
          .append("svg:g")
            .attr("transform", "translate(" + (w1 - r1) / 2 + "," + (h1 - r1) / 2 + ")");

        // add the tooltip area to the webpage
        var tooltip1 = d3.select("s1").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
            
        d3.json("circle_data/s1_circles.json", function(data) {
          node = root = data;

          var nodes1 = pack1.nodes(root);

          vis1.selectAll("circle")
              .data(nodes1)
            .enter().append("svg:circle")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("cx", function(d) { return d.x; })
              .attr("cy", function(d) { return d.y; })
              .attr("r", function(d) { return d.r; })
              .on("click", function(d) { return zoom1(node == d ? root : d); })
              .on("mouseover", function (d) {
                  d3.select("#circle_tooltip1")
                    .style("visibility", "visible")
                    .html(d.name + "<br>" + d.fb_name + "<br>" +d.size)
                    .style("top", function () { return (d3.event.pageY - 20)+"px"})
                    .style("left", function () { return (d3.event.pageX + 20)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#circle_tooltip1").style("visibility", "hidden")
                });
              ;

          vis1.selectAll("text")
              .data(nodes1)
            .enter().append("svg:text")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("x", function(d) { return d.x; })
              .attr("y", function(d) { return d.y; })
              .attr("dy", ".35em")
              .attr("text-anchor", "middle")
              .style("opacity", function(d) { return d.r > 20 ? 1 : 0; })
              .text(function(d) { return d.name; })
              ;

          d3.select(window).on("click", function() { zoom1(root); });
        });

        function zoom1(d, i) {
          var k1 = r1 / d.r / 2;
          x1.domain([d.x - d.r, d.x + d.r]);
          y1.domain([d.y - d.r, d.y + d.r]);

          var t = vis1.transition()
              .duration(d3.event.altKey ? 7500 : 750);

          t.selectAll("circle")
              .attr("cx", function(d) { return x1(d.x); })
              .attr("cy", function(d) { return y1(d.y); })
              .attr("r", function(d) { return k1 * d.r; });

          t.selectAll("text")
              .attr("x", function(d) { return x1(d.x); })
              .attr("y", function(d) { return y1(d.y); })
              .style("opacity", function(d) { return k1 * d.r > 15 ? 1 : 0; });

          node = d;
          d3.event.stopPropagation();
}

    </script>
    
    <script type="text/javascript">

        var w2 = 600,
            h2 = 600,
            r2 = 550,
            x2 = d3.scale.linear().range([0, r2]),
            y2 = d3.scale.linear().range([0, r2]),
            node2,
            root2;

        var pack = d3.layout.pack()
            .size([r2, r2])
            .value(function(d) { return d.size; })

        var vis2 = d3.select("#s2").insert("svg:svg", "h2")
            .attr("width", w2)
            .attr("height", h2)
          .append("svg:g")
            .attr("transform", "translate(" + (w2 - r2) / 2 + "," + (h2 - r2) / 2 + ")");

        // add the tooltip area to the webpage
        var tooltip = d3.select("#s2").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
            
        d3.json("circle_data/s2_circles.json", function(data) {
          node = root = data;

          var nodes2 = pack.nodes(root);

          vis2.selectAll("circle")
              .data(nodes2)
            .enter().append("svg:circle")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("cx", function(d) { return d.x; })
              .attr("cy", function(d) { return d.y; })
              .attr("r", function(d) { return d.r; })
              .on("click", function(d) { return zoom2(node == d ? root : d); })
              .on("mouseover", function (d) {
                  d3.select("#circle_tooltip2")
                    .style("visibility", "visible")
                    .html(d.name + "<br>" + d.fb_name + "<br>" +d.size)
                    .style("top", function () { return (d3.event.pageY - 20)+"px"})
                    .style("left", function () { return (d3.event.pageX + 20)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#circle_tooltip2").style("visibility", "hidden")
              })
              ;

          vis2.selectAll("text")
              .data(nodes2)
            .enter().append("svg:text")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("x", function(d) { return d.x; })
              .attr("y", function(d) { return d.y; })
              .attr("dy", ".35em")
              .attr("text-anchor", "middle")
              .style("opacity", function(d) { return d.r > 20 ? 1 : 0; })
              .text(function(d) { return d.name; })
              ;

          d3.select(window).on("click", function() { zoom2(root); });
        });

        function zoom2(d, i) {
          var k2 = r2 / d.r / 2;
          x2.domain([d.x - d.r, d.x + d.r]);
          y2.domain([d.y - d.r, d.y + d.r]);

          var t = vis2.transition()
              .duration(d3.event.altKey ? 7500 : 750);

          t.selectAll("circle")
              .attr("cx", function(d) { return x2(d.x); })
              .attr("cy", function(d) { return y2(d.y); })
              .attr("r", function(d) { return k2 * d.r; });

          t.selectAll("text")
              .attr("x", function(d) { return x2(d.x); })
              .attr("y", function(d) { return y2(d.y); })
              .style("opacity", function(d) { return k2 * d.r > 15 ? 1 : 0; });

          node = d;
          d3.event.stopPropagation();
        }

    </script>
    
    <script type="text/javascript">

        var w3 = 600,
            h3 = 600,
            r3 = 550,
            x3 = d3.scale.linear().range([0, r3]),
            y3 = d3.scale.linear().range([0, r3]),
            node3,
            root3;

        var pack = d3.layout.pack()
            .size([r3, r3])
            .value(function(d) { return d.size; })

        var vis3 = d3.select("#s3").insert("svg:svg", "h2")
            .attr("width", w3)
            .attr("height", h3)
          .append("svg:g")
            .attr("transform", "translate(" + (w3 - r3) / 2 + "," + (h3 - r3) / 2 + ")");

        // add the tooltip area to the webpage
        var tooltip = d3.select("#s3").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
            
        d3.json("circle_data/s3_circles.json", function(data) {
          node = root = data;

          var nodes3 = pack.nodes(root);

          vis3.selectAll("circle")
              .data(nodes3)
            .enter().append("svg:circle")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("cx", function(d) { return d.x; })
              .attr("cy", function(d) { return d.y; })
              .attr("r", function(d) { return d.r; })
              .on("click", function(d) { return zoom3(node == d ? root : d); })
              .on("mouseover", function (d) {
                  d3.select("#circle_tooltip3")
                    .style("visibility", "visible")
                    .html(d.name + "<br>" + d.fb_name + "<br>" +d.size)
                    .style("top", function () { return (d3.event.pageY - 20)+"px"})
                    .style("left", function () { return (d3.event.pageX + 20)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#circle_tooltip3").style("visibility", "hidden")
              })
              ;

          vis3.selectAll("text")
              .data(nodes3)
            .enter().append("svg:text")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("x", function(d) { return d.x; })
              .attr("y", function(d) { return d.y; })
              .attr("dy", ".35em")
              .attr("text-anchor", "middle")
              .style("opacity", function(d) { return d.r > 20 ? 1 : 0; })
              .text(function(d) { return d.name; })
              ;

          d3.select(window).on("click", function() { zoom3(root); });
        });

        function zoom3(d, i) {
          var k3 = r3 / d.r / 2;
          x3.domain([d.x - d.r, d.x + d.r]);
          y3.domain([d.y - d.r, d.y + d.r]);

          var t = vis3.transition()
              .duration(d3.event.altKey ? 7500 : 750);

          t.selectAll("circle")
              .attr("cx", function(d) { return x3(d.x); })
              .attr("cy", function(d) { return y3(d.y); })
              .attr("r", function(d) { return k3 * d.r; });

          t.selectAll("text")
              .attr("x", function(d) { return x3(d.x); })
              .attr("y", function(d) { return y3(d.y); })
              .style("opacity", function(d) { return k3 * d.r > 15 ? 1 : 0; });

          node = d;
          d3.event.stopPropagation();
        }

    </script>
    
    <script type="text/javascript">

        var w4 = 600,
            h4 = 600,
            r4 = 550,
            x4 = d3.scale.linear().range([0, r4]),
            y4 = d3.scale.linear().range([0, r4]),
            node4,
            root4;

        var pack = d3.layout.pack()
            .size([r4, r4])
            .value(function(d) { return d.size; })

        var vis4 = d3.select("#s4").insert("svg:svg", "h2")
            .attr("width", w4)
            .attr("height", h4)
          .append("svg:g")
            .attr("transform", "translate(" + (w4 - r4) / 2 + "," + (h4 - r4) / 2 + ")");

        // add the tooltip area to the webpage
        var tooltip = d3.select("#s4").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
            
        d3.json("circle_data/s4_circles.json", function(data) {
          node = root = data;

          var nodes4 = pack.nodes(root);

          vis4.selectAll("circle")
              .data(nodes4)
            .enter().append("svg:circle")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("cx", function(d) { return d.x; })
              .attr("cy", function(d) { return d.y; })
              .attr("r", function(d) { return d.r; })
              .on("click", function(d) { return zoom4(node == d ? root : d); })
              .on("mouseover", function (d) {
                  d3.select("#circle_tooltip4")
                    .style("visibility", "visible")
                    .html(d.name + "<br>" + d.fb_name + "<br>" +d.size)
                    .style("top", function () { return (d3.event.pageY - 20)+"px"})
                    .style("left", function () { return (d3.event.pageX + 20)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#circle_tooltip4").style("visibility", "hidden")
              })
              ;

          vis4.selectAll("text")
              .data(nodes4)
            .enter().append("svg:text")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("x", function(d) { return d.x; })
              .attr("y", function(d) { return d.y; })
              .attr("dy", ".35em")
              .attr("text-anchor", "middle")
              .style("opacity", function(d) { return d.r > 20 ? 1 : 0; })
              .text(function(d) { return d.name; })
              ;

          d3.select(window).on("click", function() { zoom4(root); });
        });

        function zoom4(d, i) {
          var k4 = r4 / d.r / 2;
          x4.domain([d.x - d.r, d.x + d.r]);
          y4.domain([d.y - d.r, d.y + d.r]);

          var t = vis4.transition()
              .duration(d3.event.altKey ? 7500 : 750);

          t.selectAll("circle")
              .attr("cx", function(d) { return x4(d.x); })
              .attr("cy", function(d) { return y4(d.y); })
              .attr("r", function(d) { return k4 * d.r; });

          t.selectAll("text")
              .attr("x", function(d) { return x4(d.x); })
              .attr("y", function(d) { return y4(d.y); })
              .style("opacity", function(d) { return k4 * d.r > 15 ? 1 : 0; });

          node = d;
          d3.event.stopPropagation();
        }

    </script>
    
    <script type="text/javascript">

        var w5 = 600,
            h5 = 600,
            r5 = 550,
            x5 = d3.scale.linear().range([0, r5]),
            y5 = d3.scale.linear().range([0, r5]),
            node5,
            root5;

        var pack = d3.layout.pack()
            .size([r5, r5])
            .value(function(d) { return d.size; })

        var vis5 = d3.select("#s5").insert("svg:svg", "h2")
            .attr("width", w5)
            .attr("height", h5)
          .append("svg:g")
            .attr("transform", "translate(" + (w5 - r5) / 2 + "," + (h5 - r5) / 2 + ")");

        // add the tooltip area to the webpage
        var tooltip = d3.select("#s5").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
            
        d3.json("circle_data/s5_circles.json", function(data) {
          node = root = data;

          var nodes5 = pack.nodes(root);

          vis5.selectAll("circle")
              .data(nodes5)
            .enter().append("svg:circle")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("cx", function(d) { return d.x; })
              .attr("cy", function(d) { return d.y; })
              .attr("r", function(d) { return d.r; })
              .on("click", function(d) { return zoom5(node == d ? root : d); })
              .on("mouseover", function (d) {
                  d3.select("#circle_tooltip5")
                    .style("visibility", "visible")
                    .html(d.name + "<br>" + d.fb_name + "<br>" +d.size)
                    .style("top", function () { return (d3.event.pageY - 20)+"px"})
                    .style("left", function () { return (d3.event.pageX + 20)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#circle_tooltip5").style("visibility", "hidden")
              })
              ;

          vis5.selectAll("text")
              .data(nodes5)
            .enter().append("svg:text")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("x", function(d) { return d.x; })
              .attr("y", function(d) { return d.y; })
              .attr("dy", ".35em")
              .attr("text-anchor", "middle")
              .style("opacity", function(d) { return d.r > 20 ? 1 : 0; })
              .text(function(d) { return d.name; })
              ;

          d3.select(window).on("click", function() { zoom5(root); });
        });

        function zoom5(d, i) {
          var k5 = r5 / d.r / 2;
          x5.domain([d.x - d.r, d.x + d.r]);
          y5.domain([d.y - d.r, d.y + d.r]);

          var t = vis5.transition()
              .duration(d3.event.altKey ? 7500 : 750);

          t.selectAll("circle")
              .attr("cx", function(d) { return x5(d.x); })
              .attr("cy", function(d) { return y5(d.y); })
              .attr("r", function(d) { return k5 * d.r; });

          t.selectAll("text")
              .attr("x", function(d) { return x5(d.x); })
              .attr("y", function(d) { return y5(d.y); })
              .style("opacity", function(d) { return k5 * d.r > 15 ? 1 : 0; });

          node = d;
          d3.event.stopPropagation();
        }

    </script>
    
    <script type="text/javascript">

        var w6 = 600,
            h6 = 600,
            r6 = 550,
            x6 = d3.scale.linear().range([0, r6]),
            y6 = d3.scale.linear().range([0, r6]),
            node6,
            root6;

        var pack = d3.layout.pack()
            .size([r6, r6])
            .value(function(d) { return d.size; })

        var vis6 = d3.select("#s6").insert("svg:svg", "h2")
            .attr("width", w6)
            .attr("height", h6)
          .append("svg:g")
            .attr("transform", "translate(" + (w6 - r6) / 2 + "," + (h6 - r6) / 2 + ")");

        // add the tooltip area to the webpage
        var tooltip = d3.select("#s6").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
            
        d3.json("circle_data/s6_circles.json", function(data) {
          node = root = data;

          var nodes6 = pack.nodes(root);

          vis6.selectAll("circle")
              .data(nodes6)
            .enter().append("svg:circle")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("cx", function(d) { return d.x; })
              .attr("cy", function(d) { return d.y; })
              .attr("r", function(d) { return d.r; })
              .on("click", function(d) { return zoom6(node == d ? root : d); })
              .on("mouseover", function (d) {
                  d3.select("#circle_tooltip6")
                    .style("visibility", "visible")
                    .html(d.name + "<br>" + d.fb_name + "<br>" +d.size)
                    .style("top", function () { return (d3.event.pageY - 20)+"px"})
                    .style("left", function () { return (d3.event.pageX + 20)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#circle_tooltip6").style("visibility", "hidden")
              })
              ;

          vis6.selectAll("text")
              .data(nodes6)
            .enter().append("svg:text")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("x", function(d) { return d.x; })
              .attr("y", function(d) { return d.y; })
              .attr("dy", ".35em")
              .attr("text-anchor", "middle")
              .style("opacity", function(d) { return d.r > 20 ? 1 : 0; })
              .text(function(d) { return d.name; })
              ;

          d3.select(window).on("click", function() { zoom6(root); });
        });

        function zoom6(d, i) {
          var k6 = r6 / d.r / 2;
          x6.domain([d.x - d.r, d.x + d.r]);
          y6.domain([d.y - d.r, d.y + d.r]);

          var t = vis6.transition()
              .duration(d3.event.altKey ? 7500 : 750);

          t.selectAll("circle")
              .attr("cx", function(d) { return x6(d.x); })
              .attr("cy", function(d) { return y6(d.y); })
              .attr("r", function(d) { return k6 * d.r; });

          t.selectAll("text")
              .attr("x", function(d) { return x6(d.x); })
              .attr("y", function(d) { return y6(d.y); })
              .style("opacity", function(d) { return k6 * d.r > 15 ? 1 : 0; });

          node = d;
          d3.event.stopPropagation();
        }

    </script>
    
    <script type="text/javascript">

        var w7 = 600,
            h7 = 600,
            r7 = 550,
            x7 = d3.scale.linear().range([0, r7]),
            y7 = d3.scale.linear().range([0, r7]),
            node7,
            root7;

        var pack = d3.layout.pack()
            .size([r7, r7])
            .value(function(d) { return d.size; })

        var vis7 = d3.select("#s7").insert("svg:svg", "h2")
            .attr("width", w7)
            .attr("height", h7)
          .append("svg:g")
            .attr("transform", "translate(" + (w7 - r7) / 2 + "," + (h7 - r7) / 2 + ")");

        // add the tooltip area to the webpage
        var tooltip = d3.select("#s7").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
            
        d3.json("circle_data/s7_circles.json", function(data) {
          node = root = data;

          var nodes7 = pack.nodes(root);

          vis7.selectAll("circle")
              .data(nodes7)
            .enter().append("svg:circle")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("cx", function(d) { return d.x; })
              .attr("cy", function(d) { return d.y; })
              .attr("r", function(d) { return d.r; })
              .on("click", function(d) { return zoom7(node == d ? root : d); })
              .on("mouseover", function (d) {
                  d3.select("#circle_tooltip7")
                    .style("visibility", "visible")
                    .html(d.name + "<br>" + d.fb_name + "<br>" +d.size)
                    .style("top", function () { return (d3.event.pageY - 20)+"px"})
                    .style("left", function () { return (d3.event.pageX + 20)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#circle_tooltip7").style("visibility", "hidden")
              })
              ;

          vis7.selectAll("text")
              .data(nodes7)
            .enter().append("svg:text")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("x", function(d) { return d.x; })
              .attr("y", function(d) { return d.y; })
              .attr("dy", ".35em")
              .attr("text-anchor", "middle")
              .style("opacity", function(d) { return d.r > 20 ? 1 : 0; })
              .text(function(d) { return d.name; })
              ;

          d3.select(window).on("click", function() { zoom7(root); });
        });

        function zoom7(d, i) {
          var k7 = r7 / d.r / 2;
          x7.domain([d.x - d.r, d.x + d.r]);
          y7.domain([d.y - d.r, d.y + d.r]);

          var t = vis7.transition()
              .duration(d3.event.altKey ? 7500 : 750);

          t.selectAll("circle")
              .attr("cx", function(d) { return x7(d.x); })
              .attr("cy", function(d) { return y7(d.y); })
              .attr("r", function(d) { return k7 * d.r; });

          t.selectAll("text")
              .attr("x", function(d) { return x7(d.x); })
              .attr("y", function(d) { return y7(d.y); })
              .style("opacity", function(d) { return k7 * d.r > 15 ? 1 : 0; });

          node = d;
          d3.event.stopPropagation();
        }

    </script>
    
    <script>
      //*******************************************************************
      //  CREATE MATRIX AND MAP
      //*******************************************************************
      d3.csv('shuffle_data/s1_shuffle.csv', function (error, data) {
        var mpr1 = chordMpr(data);

        mpr1
          .addValuesToMap('isin')
          .setFilter(function (row, a, b) {
            return (row.isin === a.name && row.goesto === b.name)
          })
          .setAccessor(function (recs, a, b) {
            if (!recs[0]) return 0;
            return +recs[0].count;
          });
        drawChords1(mpr1.getMatrix(), mpr1.getMap());
      });
      //*******************************************************************
      //  DRAW THE CHORD DIAGRAM
      //*******************************************************************
      function drawChords1 (matrix, mmap) {
        var w1 = 600, h1 = 600, r11 = h1 / 2, r10 = r11 - 100;

        var fill1 = d3.scale.ordinal()
            .domain(d3.range(4))
            .range(["#000000", "#000080", "#006400", "#00BFFF", "#696969", "#800000", "#800080", "#DA70D6"]);

        var chord1 = d3.layout.chord()
            .padding(.02)
            .sortSubgroups(d3.descending)
            .sortChords(d3.descending);

        var arc1 = d3.svg.arc()
            .innerRadius(r10)
            .outerRadius(r10 + 20);

        var svg1 = d3.select("#shuffle1").append("svg:svg")
            .attr("width", w1)
            .attr("height", h1)
          .append("svg:g")
            .attr("id", "circle")
            .attr("transform", "translate(" + w1 / 2 + "," + h1 / 2 + ")");

            svg1.append("circle")
                .attr("r", r10 + 20);

        var rdr1 = chordRdr(matrix, mmap);
        chord1.matrix(matrix);

        var g1 = svg1.selectAll("g.group")
            .data(chord1.groups())
          .enter().append("svg:g")
            .attr("class", "group")
            .on("mouseover", mouseover1)
            .on("mouseout", function (d) { d3.select("#tooltip1").style("visibility", "hidden") });

        g1.append("svg:path")
            .style("stroke", "black")
            .style("fill", function(d) { return fill1(d.index); })
            .attr("d", arc1);

        g1.append("svg:text")
            .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })
            .attr("dy", ".35em")
            .style("font-family", "helvetica, arial, sans-serif")
            .style("font-size", "10px")
            .attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
            .attr("transform", function(d) {
              return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
                  + "translate(" + (r10 + 26) + ")"
                  + (d.angle > Math.PI ? "rotate(180)" : "");
            })
            .text(function(d) { return rdr1(d).gname; });

          var chordPaths1 = svg1.selectAll("path.chord")
                .data(chord1.chords())
              .enter().append("svg:path")
                .attr("class", "chord")
                .style("stroke", function(d) { return d3.rgb(fill1(d.target.index)).darker(); })
                .style("fill", function(d) { return fill1(d.target.index); })
                .attr("d", d3.svg.chord().radius(r10))
                .on("mouseover", function (d) {
                  d3.select("#tooltip1")
                    .style("visibility", "visible")
                    .html(chordTip1(rdr1(d)))
                    .style("top", function () { return (d3.event.pageY - 100)+"px"})
                    .style("left", function () { return (d3.event.pageX - 100)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#tooltip1").style("visibility", "hidden") });

          function chordTip1 (d) {
            var p = d3.format(".1%"), q = d3.format("r")
            return "Chord Info:<br/>"
              + p(d.svalue/d.stotal) + " (" + q(d.svalue) + ") of "
              + d.sname + " move to " + d.tname
              + (d.sname === d.tname ? "": ("<br/>while...<br/>"
              + p(d.tvalue/d.ttotal) + " (" + q(d.tvalue) + ") of "
              + d.tname + " move to " + d.sname))
          }

          function groupTip1 (d) {
            var p = d3.format(".1%"), q = d3.format(",.3r")
            return "Group Info:<br/>"
                + d.gname + " : " + q(d.gvalue) + "<br/>"
                + p(d.gvalue/d.mtotal) + " of Clan Total (" + q(d.mtotal) + ")"
          }

          function mouseover1(d, i) {
            d3.select("#tooltip1")
              .style("visibility", "visible")
              .html(groupTip1(rdr1(d)))
              .style("top", function () { return (d3.event.pageY - 80)+"px"})
              .style("left", function () { return (d3.event.pageX - 130)+"px";})

            chordPaths1.classed("fade", function(p) {
              return p.source.index != i
                  && p.target.index != i;
            });
          }
      }

    </script>
    
    <script>
      //*******************************************************************
      //  CREATE MATRIX AND MAP
      //*******************************************************************
      d3.csv('shuffle_data/s2_shuffle.csv', function (error, data) {
        var mpr2 = chordMpr(data);

        mpr2
          .addValuesToMap('isin')
          .setFilter(function (row, a, b) {
            return (row.isin === a.name && row.goesto === b.name)
          })
          .setAccessor(function (recs, a, b) {
            if (!recs[0]) return 0;
            return +recs[0].count;
          });
        drawChords2(mpr2.getMatrix(), mpr2.getMap());
      });
      //*******************************************************************
      //  DRAW THE CHORD DIAGRAM
      //*******************************************************************
      function drawChords2 (matrix, mmap) {
        var w2 = 600, h2 = 600, r21 = h2 / 2, r20 = r21 - 100;

        var fill2 = d3.scale.ordinal()
            .domain(d3.range(4))
            .range(["#000000", "#000080", "#006400", "#00BFFF", "#696969", "#800000", "#800080", "#DA70D6"]);

        var chord2 = d3.layout.chord()
            .padding(.02)
            .sortSubgroups(d3.descending)
            .sortChords(d3.descending);

        var arc2 = d3.svg.arc()
            .innerRadius(r20)
            .outerRadius(r20 + 20);

        var svg2 = d3.select("#shuffle2").append("svg:svg")
            .attr("width", w2)
            .attr("height", h2)
          .append("svg:g")
            .attr("id", "circle")
            .attr("transform", "translate(" + w2 / 2 + "," + h2 / 2 + ")");

            svg2.append("circle")
                .attr("r", r20 + 20);

        var rdr2 = chordRdr(matrix, mmap);
        chord2.matrix(matrix);

        var g2 = svg2.selectAll("g.group")
            .data(chord2.groups())
          .enter().append("svg:g")
            .attr("class", "group")
            .on("mouseover", mouseover2)
            .on("mouseout", function (d) { d3.select("#tooltip2").style("visibility", "hidden") });

        g2.append("svg:path")
            .style("stroke", "black")
            .style("fill", function(d) { return fill2(d.index); })
            .attr("d", arc2);

        g2.append("svg:text")
            .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })
            .attr("dy", ".35em")
            .style("font-family", "helvetica, arial, sans-serif")
            .style("font-size", "10px")
            .attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
            .attr("transform", function(d) {
              return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
                  + "translate(" + (r20 + 26) + ")"
                  + (d.angle > Math.PI ? "rotate(180)" : "");
            })
            .text(function(d) { return rdr2(d).gname; });

          var chordPaths2 = svg2.selectAll("path.chord")
                .data(chord2.chords())
              .enter().append("svg:path")
                .attr("class", "chord")
                .style("stroke", function(d) { return d3.rgb(fill2(d.target.index)).darker(); })
                .style("fill", function(d) { return fill2(d.target.index); })
                .attr("d", d3.svg.chord().radius(r20))
                .on("mouseover", function (d) {
                  d3.select("#tooltip2")
                    .style("visibility", "visible")
                    .html(chordTip2(rdr2(d)))
                    .style("top", function () { return (d3.event.pageY - 100)+"px"})
                    .style("left", function () { return (d3.event.pageX - 100)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#tooltip2").style("visibility", "hidden") });

          function chordTip2 (d) {
            var p = d3.format(".1%"), q = d3.format("r")
            return "Chord Info:<br/>"
              + p(d.svalue/d.stotal) + " (" + q(d.svalue) + ") of "
              + d.sname + " move to " + d.tname
              + (d.sname === d.tname ? "": ("<br/>while...<br/>"
              + p(d.tvalue/d.ttotal) + " (" + q(d.tvalue) + ") of "
              + d.tname + " move to " + d.sname))
          }

          function groupTip2 (d) {
            var p = d3.format(".1%"), q = d3.format(",.3r")
            return "Group Info:<br/>"
                + d.gname + " : " + q(d.gvalue) + "<br/>"
                + p(d.gvalue/d.mtotal) + " of Clan Total (" + q(d.mtotal) + ")"
          }

          function mouseover2(d, i) {
            d3.select("#tooltip2")
              .style("visibility", "visible")
              .html(groupTip2(rdr2(d)))
              .style("top", function () { return (d3.event.pageY - 80)+"px"})
              .style("left", function () { return (d3.event.pageX - 130)+"px";})

            chordPaths2.classed("fade", function(p) {
              return p.source.index != i
                  && p.target.index != i;
            });
          }
      }

    </script>
    
    <script>
      //*******************************************************************
      //  CREATE MATRIX AND MAP
      //*******************************************************************
      d3.csv('shuffle_data/s3_shuffle.csv', function (error, data) {
        var mpr3 = chordMpr(data);

        mpr3
          .addValuesToMap('isin')
          .setFilter(function (row, a, b) {
            return (row.isin === a.name && row.goesto === b.name)
          })
          .setAccessor(function (recs, a, b) {
            if (!recs[0]) return 0;
            return +recs[0].count;
          });
        drawChords3(mpr3.getMatrix(), mpr3.getMap());
      });
      //*******************************************************************
      //  DRAW THE CHORD DIAGRAM
      //*******************************************************************
      function drawChords3 (matrix, mmap) {
        var w3 = 600, h3 = 600, r31 = h3 / 2, r30 = r31 - 100;

        var fill3 = d3.scale.ordinal()
            .domain(d3.range(4))
            .range(["#000000", "#000080", "#006400", "#00BFFF", "#696969", "#800000", "#800080", "#DA70D6"]);

        var chord3 = d3.layout.chord()
            .padding(.02)
            .sortSubgroups(d3.descending)
            .sortChords(d3.descending);

        var arc3 = d3.svg.arc()
            .innerRadius(r30)
            .outerRadius(r30 + 20);

        var svg3 = d3.select("#shuffle3").append("svg:svg")
            .attr("width", w3)
            .attr("height", h3)
          .append("svg:g")
            .attr("id", "circle")
            .attr("transform", "translate(" + w3 / 2 + "," + h3 / 2 + ")");

            svg3.append("circle")
                .attr("r", r30 + 20);

        var rdr3 = chordRdr(matrix, mmap);
        chord3.matrix(matrix);

        var g3 = svg3.selectAll("g.group")
            .data(chord3.groups())
          .enter().append("svg:g")
            .attr("class", "group")
            .on("mouseover", mouseover3)
            .on("mouseout", function (d) { d3.select("#tooltip3").style("visibility", "hidden") });

        g3.append("svg:path")
            .style("stroke", "black")
            .style("fill", function(d) { return fill3(d.index); })
            .attr("d", arc3);

        g3.append("svg:text")
            .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })
            .attr("dy", ".35em")
            .style("font-family", "helvetica, arial, sans-serif")
            .style("font-size", "10px")
            .attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
            .attr("transform", function(d) {
              return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
                  + "translate(" + (r30 + 26) + ")"
                  + (d.angle > Math.PI ? "rotate(180)" : "");
            })
            .text(function(d) { return rdr3(d).gname; });

          var chordPaths3 = svg3.selectAll("path.chord")
                .data(chord3.chords())
              .enter().append("svg:path")
                .attr("class", "chord")
                .style("stroke", function(d) { return d3.rgb(fill3(d.target.index)).darker(); })
                .style("fill", function(d) { return fill3(d.target.index); })
                .attr("d", d3.svg.chord().radius(r30))
                .on("mouseover", function (d) {
                  d3.select("#tooltip3")
                    .style("visibility", "visible")
                    .html(chordTip3(rdr3(d)))
                    .style("top", function () { return (d3.event.pageY - 100)+"px"})
                    .style("left", function () { return (d3.event.pageX - 100)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#tooltip3").style("visibility", "hidden") });

          function chordTip3 (d) {
            var p = d3.format(".1%"), q = d3.format("r")
            return "Chord Info:<br/>"
              + p(d.svalue/d.stotal) + " (" + q(d.svalue) + ") of "
              + d.sname + " move to " + d.tname
              + (d.sname === d.tname ? "": ("<br/>while...<br/>"
              + p(d.tvalue/d.ttotal) + " (" + q(d.tvalue) + ") of "
              + d.tname + " move to " + d.sname))
          }

          function groupTip3 (d) {
            var p = d3.format(".1%"), q = d3.format(",.3r")
            return "Group Info:<br/>"
                + d.gname + " : " + q(d.gvalue) + "<br/>"
                + p(d.gvalue/d.mtotal) + " of Clan Total (" + q(d.mtotal) + ")"
          }

          function mouseover3(d, i) {
            d3.select("#tooltip3")
              .style("visibility", "visible")
              .html(groupTip3(rdr3(d)))
              .style("top", function () { return (d3.event.pageY - 80)+"px"})
              .style("left", function () { return (d3.event.pageX - 130)+"px";})

            chordPaths3.classed("fade", function(p) {
              return p.source.index != i
                  && p.target.index != i;
            });
          }
      }

    </script>
    
    <script>
      //*******************************************************************
      //  CREATE MATRIX AND MAP
      //*******************************************************************
      d3.csv('shuffle_data/s4_shuffle.csv', function (error, data) {
        var mpr4 = chordMpr(data);

        mpr4
          .addValuesToMap('isin')
          .setFilter(function (row, a, b) {
            return (row.isin === a.name && row.goesto === b.name)
          })
          .setAccessor(function (recs, a, b) {
            if (!recs[0]) return 0;
            return +recs[0].count;
          });
        drawChords4(mpr4.getMatrix(), mpr4.getMap());
      });
      //*******************************************************************
      //  DRAW THE CHORD DIAGRAM
      //*******************************************************************
      function drawChords4 (matrix, mmap) {
        var w4 = 600, h4 = 600, r41 = h4 / 2, r40 = r41 - 100;

        var fill4 = d3.scale.ordinal()
            .domain(d3.range(4))
            .range(["#000000", "#000080", "#006400", "#00BFFF", "#696969", "#800000", "#800080", "#DA70D6"]);

        var chord4 = d3.layout.chord()
            .padding(.02)
            .sortSubgroups(d3.descending)
            .sortChords(d3.descending);

        var arc4 = d3.svg.arc()
            .innerRadius(r40)
            .outerRadius(r40 + 20);

        var svg4 = d3.select("#shuffle4").append("svg:svg")
            .attr("width", w4)
            .attr("height", h4)
          .append("svg:g")
            .attr("id", "circle")
            .attr("transform", "translate(" + w4 / 2 + "," + h4 / 2 + ")");

            svg4.append("circle")
                .attr("r", r40 + 20);

        var rdr4 = chordRdr(matrix, mmap);
        chord4.matrix(matrix);

        var g4 = svg4.selectAll("g.group")
            .data(chord4.groups())
          .enter().append("svg:g")
            .attr("class", "group")
            .on("mouseover", mouseover4)
            .on("mouseout", function (d) { d3.select("#tooltip4").style("visibility", "hidden") });

        g4.append("svg:path")
            .style("stroke", "black")
            .style("fill", function(d) { return fill4(d.index); })
            .attr("d", arc4);

        g4.append("svg:text")
            .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })
            .attr("dy", ".35em")
            .style("font-family", "helvetica, arial, sans-serif")
            .style("font-size", "10px")
            .attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
            .attr("transform", function(d) {
              return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
                  + "translate(" + (r40 + 26) + ")"
                  + (d.angle > Math.PI ? "rotate(180)" : "");
            })
            .text(function(d) { return rdr4(d).gname; });

          var chordPaths4 = svg4.selectAll("path.chord")
                .data(chord4.chords())
              .enter().append("svg:path")
                .attr("class", "chord")
                .style("stroke", function(d) { return d3.rgb(fill4(d.target.index)).darker(); })
                .style("fill", function(d) { return fill4(d.target.index); })
                .attr("d", d3.svg.chord().radius(r40))
                .on("mouseover", function (d) {
                  d3.select("#tooltip4")
                    .style("visibility", "visible")
                    .html(chordTip4(rdr4(d)))
                    .style("top", function () { return (d3.event.pageY - 100)+"px"})
                    .style("left", function () { return (d3.event.pageX - 100)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#tooltip4").style("visibility", "hidden") });

          function chordTip4 (d) {
            var p = d3.format(".1%"), q = d3.format("r")
            return "Chord Info:<br/>"
              + p(d.svalue/d.stotal) + " (" + q(d.svalue) + ") of "
              + d.sname + " move to " + d.tname
              + (d.sname === d.tname ? "": ("<br/>while...<br/>"
              + p(d.tvalue/d.ttotal) + " (" + q(d.tvalue) + ") of "
              + d.tname + " move to " + d.sname))
          }

          function groupTip4 (d) {
            var p = d3.format(".1%"), q = d3.format(",.3r")
            return "Group Info:<br/>"
                + d.gname + " : " + q(d.gvalue) + "<br/>"
                + p(d.gvalue/d.mtotal) + " of Clan Total (" + q(d.mtotal) + ")"
          }

          function mouseover4(d, i) {
            d3.select("#tooltip4")
              .style("visibility", "visible")
              .html(groupTip4(rdr4(d)))
              .style("top", function () { return (d3.event.pageY - 80)+"px"})
              .style("left", function () { return (d3.event.pageX - 130)+"px";})

            chordPaths4.classed("fade", function(p) {
              return p.source.index != i
                  && p.target.index != i;
            });
          }
      }

    </script>
    
    <script>
      //*******************************************************************
      //  CREATE MATRIX AND MAP
      //*******************************************************************
      d3.csv('shuffle_data/s5_shuffle.csv', function (error, data) {
        var mpr5 = chordMpr(data);

        mpr5
          .addValuesToMap('isin')
          .setFilter(function (row, a, b) {
            return (row.isin === a.name && row.goesto === b.name)
          })
          .setAccessor(function (recs, a, b) {
            if (!recs[0]) return 0;
            return +recs[0].count;
          });
        drawChords5(mpr5.getMatrix(), mpr5.getMap());
      });
      //*******************************************************************
      //  DRAW THE CHORD DIAGRAM
      //*******************************************************************
      function drawChords5 (matrix, mmap) {
        var w5 = 600, h5 = 600, r51 = h5 / 2, r50 = r51 - 100;

        var fill5 = d3.scale.ordinal()
            .domain(d3.range(4))
            .range(["#000000", "#000080", "#006400", "#00BFFF", "#696969", "#800000", "#800080", "#DA70D6"]);

        var chord5 = d3.layout.chord()
            .padding(.02)
            .sortSubgroups(d3.descending)
            .sortChords(d3.descending);

        var arc5 = d3.svg.arc()
            .innerRadius(r50)
            .outerRadius(r50 + 20);

        var svg5 = d3.select("#shuffle5").append("svg:svg")
            .attr("width", w5)
            .attr("height", h5)
          .append("svg:g")
            .attr("id", "circle")
            .attr("transform", "translate(" + w5 / 2 + "," + h5 / 2 + ")");

            svg5.append("circle")
                .attr("r", r50 + 20);

        var rdr5 = chordRdr(matrix, mmap);
        chord5.matrix(matrix);

        var g5 = svg5.selectAll("g.group")
            .data(chord5.groups())
          .enter().append("svg:g")
            .attr("class", "group")
            .on("mouseover", mouseover5)
            .on("mouseout", function (d) { d3.select("#tooltip5").style("visibility", "hidden") });

        g5.append("svg:path")
            .style("stroke", "black")
            .style("fill", function(d) { return fill5(d.index); })
            .attr("d", arc5);

        g5.append("svg:text")
            .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })
            .attr("dy", ".35em")
            .style("font-family", "helvetica, arial, sans-serif")
            .style("font-size", "10px")
            .attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
            .attr("transform", function(d) {
              return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
                  + "translate(" + (r50 + 26) + ")"
                  + (d.angle > Math.PI ? "rotate(180)" : "");
            })
            .text(function(d) { return rdr5(d).gname; });

          var chordPaths5 = svg5.selectAll("path.chord")
                .data(chord5.chords())
              .enter().append("svg:path")
                .attr("class", "chord")
                .style("stroke", function(d) { return d3.rgb(fill5(d.target.index)).darker(); })
                .style("fill", function(d) { return fill5(d.target.index); })
                .attr("d", d3.svg.chord().radius(r50))
                .on("mouseover", function (d) {
                  d3.select("#tooltip5")
                    .style("visibility", "visible")
                    .html(chordTip5(rdr5(d)))
                    .style("top", function () { return (d3.event.pageY - 100)+"px"})
                    .style("left", function () { return (d3.event.pageX - 100)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#tooltip5").style("visibility", "hidden") });

          function chordTip5 (d) {
            var p = d3.format(".1%"), q = d3.format("r")
            return "Chord Info:<br/>"
              + p(d.svalue/d.stotal) + " (" + q(d.svalue) + ") of "
              + d.sname + " move to " + d.tname
              + (d.sname === d.tname ? "": ("<br/>while...<br/>"
              + p(d.tvalue/d.ttotal) + " (" + q(d.tvalue) + ") of "
              + d.tname + " move to " + d.sname))
          }

          function groupTip5 (d) {
            var p = d3.format(".1%"), q = d3.format(",.3r")
            return "Group Info:<br/>"
                + d.gname + " : " + q(d.gvalue) + "<br/>"
                + p(d.gvalue/d.mtotal) + " of Clan Total (" + q(d.mtotal) + ")"
          }

          function mouseover5(d, i) {
            d3.select("#tooltip5")
              .style("visibility", "visible")
              .html(groupTip5(rdr5(d)))
              .style("top", function () { return (d3.event.pageY - 80)+"px"})
              .style("left", function () { return (d3.event.pageX - 130)+"px";})

            chordPaths5.classed("fade", function(p) {
              return p.source.index != i
                  && p.target.index != i;
            });
          }
      }

    </script>

    <script>
      //*******************************************************************
      //  CREATE MATRIX AND MAP
      //*******************************************************************
      d3.csv('shuffle_data/s6_shuffle.csv', function (error, data) {
        var mpr6 = chordMpr(data);

        mpr6
          .addValuesToMap('isin')
          .setFilter(function (row, a, b) {
            return (row.isin === a.name && row.goesto === b.name)
          })
          .setAccessor(function (recs, a, b) {
            if (!recs[0]) return 0;
            return +recs[0].count;
          });
        drawChords6(mpr6.getMatrix(), mpr6.getMap());
      });
      //*******************************************************************
      //  DRAW THE CHORD DIAGRAM
      //*******************************************************************
      function drawChords6 (matrix, mmap) {
        var w6 = 600, h6 = 600, r61 = h6 / 2, r60 = r61 - 100;

        var fill6 = d3.scale.ordinal()
            .domain(d3.range(4))
            .range(["#000000", "#000080", "#006400", "#00BFFF", "#696969", "#800000", "#800080", "#DA70D6"]);

        var chord6 = d3.layout.chord()
            .padding(.02)
            .sortSubgroups(d3.descending)
            .sortChords(d3.descending);

        var arc6 = d3.svg.arc()
            .innerRadius(r60)
            .outerRadius(r60 + 20);

        var svg6 = d3.select("#shuffle6").append("svg:svg")
            .attr("width", w6)
            .attr("height", h6)
          .append("svg:g")
            .attr("id", "circle")
            .attr("transform", "translate(" + w6 / 2 + "," + h6 / 2 + ")");

            svg6.append("circle")
                .attr("r", r60 + 20);

        var rdr6 = chordRdr(matrix, mmap);
        chord6.matrix(matrix);

        var g6 = svg6.selectAll("g.group")
            .data(chord6.groups())
          .enter().append("svg:g")
            .attr("class", "group")
            .on("mouseover", mouseover6)
            .on("mouseout", function (d) { d3.select("#tooltip6").style("visibility", "hidden") });

        g6.append("svg:path")
            .style("stroke", "black")
            .style("fill", function(d) { return fill6(d.index); })
            .attr("d", arc6);

        g6.append("svg:text")
            .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })
            .attr("dy", ".35em")
            .style("font-family", "helvetica, arial, sans-serif")
            .style("font-size", "10px")
            .attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
            .attr("transform", function(d) {
              return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
                  + "translate(" + (r60 + 26) + ")"
                  + (d.angle > Math.PI ? "rotate(180)" : "");
            })
            .text(function(d) { return rdr6(d).gname; });

          var chordPaths6 = svg6.selectAll("path.chord")
                .data(chord6.chords())
              .enter().append("svg:path")
                .attr("class", "chord")
                .style("stroke", function(d) { return d3.rgb(fill6(d.target.index)).darker(); })
                .style("fill", function(d) { return fill6(d.target.index); })
                .attr("d", d3.svg.chord().radius(r60))
                .on("mouseover", function (d) {
                  d3.select("#tooltip6")
                    .style("visibility", "visible")
                    .html(chordTip6(rdr6(d)))
                    .style("top", function () { return (d3.event.pageY - 100)+"px"})
                    .style("left", function () { return (d3.event.pageX - 100)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#tooltip6").style("visibility", "hidden") });

          function chordTip6 (d) {
            var p = d3.format(".1%"), q = d3.format("r")
            return "Chord Info:<br/>"
              + p(d.svalue/d.stotal) + " (" + q(d.svalue) + ") of "
              + d.sname + " move to " + d.tname
              + (d.sname === d.tname ? "": ("<br/>while...<br/>"
              + p(d.tvalue/d.ttotal) + " (" + q(d.tvalue) + ") of "
              + d.tname + " move to " + d.sname))
          }

          function groupTip6 (d) {
            var p = d3.format(".1%"), q = d3.format(",.3r")
            return "Group Info:<br/>"
                + d.gname + " : " + q(d.gvalue) + "<br/>"
                + p(d.gvalue/d.mtotal) + " of Clan Total (" + q(d.mtotal) + ")"
          }

          function mouseover6(d, i) {
            d3.select("#tooltip6")
              .style("visibility", "visible")
              .html(groupTip6(rdr6(d)))
              .style("top", function () { return (d3.event.pageY - 80)+"px"})
              .style("left", function () { return (d3.event.pageX - 130)+"px";})

            chordPaths6.classed("fade", function(p) {
              return p.source.index != i
                  && p.target.index != i;
            });
          }
      }

    </script>
    
</body>
</html>
